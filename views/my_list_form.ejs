<section class="card set-builder">
  <div class="builder-header">
    <div>
      <p class="eyebrow"><%= set ? 'Modifier ma liste' : 'Créer une nouvelle liste' %></p>
      <h1><%= set ? set.name : 'Nouvelle liste' %></h1>
    </div>
    <div class="builder-actions">
      <a class="link back-link" href="/my/lists">&#8592; Retour</a>
    </div>
  </div>

  <% if (error) { %>
    <div class="alert alert-error"><%= error %></div>
  <% } %>
  <div class="form-banner" id="form-banner" style="display:none;"></div>

  <form id="list-builder-form" method="post" action="<%= action %>" class="builder-form">
    <label class="title-field">Titre de la liste
      <input type="text" name="name" value="<%= set ? set.name : '' %>" placeholder="Ex : Vocabulaire de base" required />
    </label>

    <div id="cards-container" class="cards-stack">
      <% (cards || []).forEach((card, idx) => { %>
        <div class="builder-card" data-card-index="<%= idx %>" id="card-<%= card.id ? card.id : 'new-' + idx %>">
          <div class="builder-card-head">
            <div class="card-number"><%= idx + 1 %></div>
            <button type="button" class="dots-btn" aria-label="Actions de la carte">...</button>
          </div>
          <div class="builder-fields">
            <input type="hidden" data-field="id" name="cards[<%= idx %>][id]" value="<%= card.id || '' %>" />
            <label>Mot hebreu
              <input data-field="hebrew" name="cards[<%= idx %>][hebrew]" type="text" value="<%= card.hebrew || '' %>" placeholder="שָׁלוֹם" required />
            </label>
            <label>Mot francais
              <input data-field="french" name="cards[<%= idx %>][french]" type="text" value="<%= card.french || '' %>" placeholder="Bonjour" required />
            </label>
            <label>Phonetique
              <input data-field="transliteration" name="cards[<%= idx %>][transliteration]" type="text" value="<%= card.transliteration || '' %>" placeholder="Shalom" />
            </label>
          </div>
          <div class="card-actions" data-menu>
            <button type="button" class="icon-only danger" data-action="delete" title="Supprimer cette carte">&#128465;</button>
            <button type="button" class="icon-only" data-action="move-up" title="Monter la carte">&#8593;</button>
            <button type="button" class="icon-only" data-action="move-down" title="Descendre la carte">&#8595;</button>
          </div>
        </div>
      <% }) %>
    </div>

    <div class="list-bottom-actions fixed-actions">
      <button type="button" class="cta secondary" id="add-card-bottom">Ajouter des cartes</button>
      <button type="submit" form="list-builder-form" class="cta">Enregistrer la liste</button>
    </div>
  </form>

  <template id="card-template">
    <div class="builder-card" data-card-index="__index__" id="card-new-__index__">
      <div class="builder-card-head">
        <div class="card-number"></div>
        <button type="button" class="dots-btn" aria-label="Actions de la carte">...</button>
      </div>
      <div class="builder-fields">
        <input type="hidden" data-field="id" name="" value="" />
        <label>Mot hebreu
          <input data-field="hebrew" name="" type="text" value="" placeholder="שָׁלוֹם" required />
        </label>
        <label>Mot francais
          <input data-field="french" name="" type="text" value="" placeholder="Bonjour" required />
        </label>
        <label>Phonetique
          <input data-field="transliteration" name="" type="text" value="" placeholder="Shalom" />
        </label>
      </div>
      <div class="card-actions" data-menu>
        <button type="button" class="icon-only danger" data-action="delete" title="Supprimer cette carte">&#128465;</button>
        <button type="button" class="icon-only" data-action="move-up" title="Monter la carte">&#8593;</button>
        <button type="button" class="icon-only" data-action="move-down" title="Descendre la carte">&#8595;</button>
      </div>
    </div>
  </template>
</section>

<script src="/builder.js"></script>
<script>
  window.initCardBuilder && window.initCardBuilder({
    containerId: 'cards-container',
    templateId: 'card-template',
    addButtonId: 'add-card-bottom',
    formId: 'list-builder-form',
    bannerId: 'form-banner'
  });
</script>

