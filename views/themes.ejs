<section>
  <div class="list-header">
    <h1>Themes</h1>
    <div class="mode-switch">
      <button type="button" class="tab-btn active" data-target="tab-actif">Actifs</button>
      <button type="button" class="tab-btn" data-target="tab-inactif">Inactifs</button>
    </div>
  </div>

  <div id="tab-actif" class="tab-panel">
    <div class="card">
      <h3 style="margin-top:0;">Themes actifs</h3>
      <% if (!activeThemes || activeThemes.length === 0) { %>
        <p>Pas encore de themes publics.</p>
      <% } else { %>
        <ul class="list">
          <% activeThemes.forEach(t => { %>
            <li class="theme-row">
              <div>
                <strong><%= t.name %></strong>
              </div>
              <div class="inline-actions">
                <a class="btn ghost" href="/themes/<%= t.id %>">Voir</a>
                <button type="button" class="icon-btn ghost dots-btn" data-menu-btn aria-label="Actions">&#8942;</button>
                <div class="card-menu" data-menu>
                  <form action="/themes/<%= t.id %>/toggle-visibility" method="post">
                    <button type="submit" class="menu-item">
                      <span>Masquer</span>
                      <span class="menu-icon">&#128065;</span>
                    </button>
                  </form>
                  <% if (isAdmin) { %>
                    <form action="/themes/<%= t.id %>/toggle" method="post">
                      <button type="submit" class="menu-item">
                        <span>DÃ©sactiver (admin)</span>
                        <span class="menu-icon">&#9940;</span>
                      </button>
                    </form>
                  <% } %>
                </div>
              </div>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>
  </div>

  <div id="tab-inactif" class="tab-panel" style="display:none;">
    <div class="card">
      <h3 style="margin-top:0;">Themes inactifs</h3>
      <% const hasInactive = (inactivePersonal && inactivePersonal.length > 0) || (inactiveProposed && inactiveProposed.length > 0); %>
      <% if (!hasInactive) { %>
        <p>Aucun theme inactif.</p>
      <% } %>

      <% if (inactivePersonal && inactivePersonal.length > 0) { %>
        <p class="eyebrow">Inactifs pour moi</p>
        <ul class="list">
          <% inactivePersonal.forEach(t => { %>
            <li class="theme-row">
              <div>
                <strong><%= t.name %></strong>
                <span class="pill muted mini">Inactif pour moi</span>
              </div>
              <div class="inline-actions">
                <a class="btn ghost" href="/themes/<%= t.id %>">Voir</a>
                <button type="button" class="icon-btn ghost dots-btn" data-menu-btn aria-label="Actions">&#8942;</button>
                <div class="card-menu" data-menu>
                  <form action="/themes/<%= t.id %>/toggle-visibility" method="post">
                    <button type="submit" class="menu-item">
                      <span>Afficher</span>
                      <span class="menu-icon">&#128065;</span>
                    </button>
                  </form>
                </div>
              </div>
            </li>
          <% }) %>
        </ul>
      <% } %>

      <% if (inactiveProposed && inactiveProposed.length > 0) { %>
        <p class="eyebrow">Inactifs (admin)</p>
        <ul class="list">
          <% inactiveProposed.forEach(t => { %>
            <li class="theme-row">
              <div><strong><%= t.name %></strong></div>
              <div class="inline-actions">
                <% if (isAdmin) { %>
                  <form action="/themes/<%= t.id %>/toggle" method="post" style="margin-right:0.5rem;">
                    <button class="btn ghost" type="submit" title="Activer">Activer</button>
                  </form>
                <% } else { %>
                  <span class="pill muted mini">Inactif</span>
                <% } %>
              </div>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>
  </div>
</section>

<script>
  (() => {
    const tabs = document.querySelectorAll('.tab-btn');
    const panels = document.querySelectorAll('.tab-panel');
    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        panels.forEach(p => {
          p.style.display = p.id === target ? 'block' : 'none';
        });
      });
    });

    const closeMenus = () => document.querySelectorAll('.card-menu.open').forEach(m => m.classList.remove('open'));
    document.querySelectorAll('[data-menu-btn]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        closeMenus();
        const menu = btn.parentElement.querySelector('[data-menu]');
        if (menu) menu.classList.add('open');
      });
    });
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.inline-actions')) closeMenus();
    });
  })();
</script>
